<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <script>
        /**
         * checks whether the current field is set
         * @param id of the current field
         * @returns {boolean} true if the current field isn't empty,
         * otherwise - false
         */
        function validate(id) {
            var value = $(id); //reference to the field with curent id
            var result = true;
            if (!value.val()) {
                result = false;
                alert(value.attr('name').concat(' is empty'));
            }
            return result;
        }

        /**
         * gets value of a radio button with attribute of name
         * equals to gender which is checked
         * @returns {*} a value of a curent radio button
         */
        function getCheckedElem() {
            var radio = document.getElementsByName('gender');
            var gender_value;
            for (var i = 0; i < radio.length; i++) {
                if (radio[i].checked) {
                    gender_value = radio[i].value;
                }
            }
            return gender_value;
        }

        /**
         * Fills the table with data from
         * the MemoreStore
         */
        function fillTable() {
            $.ajax({
                url: "/json",
                method: "GET",
                complete: function (response) {
                    var result = "";
                    var users = JSON.parse(response.responseText);
                    for (var i = 0; i < users.length; i++) {
                        var user = users[i];
                        result +=
                            "<tr>\n" +
                                "<td>" + user.firstName + "</td>\n" +
                                "<td>" + user.secondName + "</td>\n" +
                                "<td>" + user.sex + "</td>\n" +
                                "<td>" + user.description + "</td>\n" +
                            "</tr>";
                    }
                    var table = document.getElementById("header-users");
                    table.innerHTML = result;
                }
            });
        }

        /**
         * sends input information of user to the server
         * and gets back some information from server to
         * filling the table
         */
        function doPost() {
            if (validate('#name') & validate('#surname') & validate('#description')) {
                $.ajax({
                    type: 'POST',
                    url: '/json',
                    dataType: 'json',
                    async: false,
                    data: {
                        json: JSON.stringify(
                            {
                                firstName: $('#name').val(),
                                secondName: $('#surname').val(),
                                sex: getCheckedElem(),
                                description: $('#description').val()
                            }
                        )
                    }
                }).then(fillTable());
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h3>Registration form</h3>
        <div class="form-group">
            <label for="name">Firstname:</label>
            <input type="text" class="form-control" id="name" placeholder="Enter firstname" name="firstname">
        </div>
        <div class="form-group">
            <label for="surname">Lastname:</label>
            <input type="text" class="form-control" id="surname" placeholder="Enter lastname" name="lastname">
        </div>
        <div class="form-group">
            <label for="sex">Sex:</label><br>
            <label id="sex">
                <input type="radio" name="gender" value="male">Male
                <input type="radio" name="gender" value="female">Female
                <input type="radio" name="gender" value="other" checked>Other
            </label>
        </div>
        <div class="form-group">
            <label for="description">Description:</label><br>
            <textarea id="description" name="description" cols="25"></textarea>
        </div>
        <button class="btn btn-primary" onclick="doPost()">Submit</button>
    </div>
    <div class="container" style="margin-top: 20px">
        <table class="table">
            <thead>
            <tr>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Sex</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody id="header-users"></tbody>
        </table>
    </div>
</body>
</html>
